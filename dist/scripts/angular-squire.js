/**
* @preserve angular-squire - angularjs directive for squire rich text editor
* @version v0.5.1
* @link https://github.com/HourlyNerd/angular-squire
* @license MIT
**/
(function(){angular.module("angular-squire",[]).directive("squire",["squireService",function(e){return{restrict:"E",require:"ngModel",scope:{height:"@height",width:"@width",body:"=body",placeholder:"@placeholder",editorClass:"@editorClass"},replace:!0,transclude:!0,templateUrl:"/modules/angular-squire/editor.html",controller:["$scope",function(e){var n;return n=!0,e.isEditorVisible=function(){return n},e.editorVisibility=this.editorVisibility=function(t){var i;return 1!==arguments.length?n:(n=t,t&&null!=(i=e.editor)?i.focus():void 0)}}],link:function(n,t,i,r){var a,s,l,o,c,d,u,v,f,g,m,p,h,k,b,L;return l="http://",s="angular-squire-iframe",a="h4",o=n.editor=null,n.data={link:l},b=function(i){return i=e.sanitize.input(i,o),n.$evalAsync(function(){return r.$setViewValue(i),r.$isEmpty(i)?t.removeClass("squire-has-value"):t.addClass("squire-has-value")})},r.$render=function(){return null!=o?o.setHTML(r.$viewValue||""):void 0},r.$isEmpty=function(e){return angular.isString(e)?0===angular.element("<div>"+e+"</div>").text().trim().length:!e},c=function(){return o?angular.element(o.getSelection().commonAncestorContainer).closest("a").attr("href"):l},n.canRemoveLink=function(){var e;return e=c(),e&&e!==l},n.canAddLink=function(){return n.data.link&&n.data.link!==l},n.$on("$destroy",function(){return null!=o?o.destroy():void 0}),n.showPlaceholder=function(){return r.$isEmpty(r.$viewValue)},n.popoverHide=function(e,t){var i;return i=function(){return angular.element(e.target).closest(".popover-visible").removeClass("popover-visible"),n.action(t)},e.keyCode?13===e.keyCode?i():void 0:i()},n.popoverShow=function(e){var i,r;i=angular.element(e.currentTarget),angular.element(e.target).closest(".squire-popover").length||i.hasClass("popover-visible")||(i.addClass("popover-visible"),n.data.link=/>A\b/.test(o.getPath())||o.hasFormat("A")?c():l,r=t.find(".squire-popover").find("input").focus().end(),r.css({left:-1*(r.width()/2)+i.width()/2+2}))},L=function(e){var t;return t=e.head,_.each(angular.element("link"),function(n){var i;return i=e.createElement("link"),i.setAttribute("href",n.href),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),t.appendChild(i)}),e.childNodes[0].className=s+" ",n.editorClass?e.childNodes[0].className+=n.editorClass:void 0},u=t.find("iframe"),h=t.find(".menu"),d=!1,v=function(){var i;return i=u[0].contentWindow.document,L(i),r.$setPristine(),o=n.editor=new Squire(i),o.defaultBlockTag="P",n.body&&(o.setHTML(n.body),b(n.body),d=!0),o.addEventListener("willPaste",function(n){return e.sanitize.paste(n,o)}),o.addEventListener("input",function(){var e;return d?(e=o.getHTML(),b(e)):void 0}),o.addEventListener("focus",function(){return t.addClass("focus").triggerHandler("focus"),n.editorVisibility(!0),d=!0}),o.addEventListener("blur",function(){return t.removeClass("focus").triggerHandler("blur"),r.$pristine&&!r.$isEmpty(r.$viewValue)?r.$setTouched():r.$setPristine(),d=!0}),o.addEventListener("pathChange",function(){var e,n;return e=o.getPath(),/>A\b/.test(e)||o.hasFormat("A")?t.find(".add-link").addClass("active"):t.find(".add-link").removeClass("active"),h.attr("class","menu "+(null!=(n=e.split("BODY")[1])?n.replace(/>|\.|html|body|div/gi," ").replace(RegExp(a,"g"),"size").toLowerCase():void 0))}),o.alignRight=function(){return o.setTextAlignment("right")},o.alignCenter=function(){return o.setTextAlignment("center")},o.alignLeft=function(){return o.setTextAlignment("left")},o.alignJustify=function(){return o.setTextAlignment("justify")},o.makeHeading=function(){var e;return e=!h.hasClass("size"),o.forEachBlock(function(n){return e?angular.element(n).addClass(a):angular.element(n).removeClass(a)},!0),o.focus()}},k=navigator.userAgent,f=/Chrome/.test(k),m=/rv:11.0|IE/.test(k),g=!f&&!m,p=!1,u.on("load",function(){return p=!0}),f?v():t.one("mouseenter",function(){return g?p?v():u.on("load",v):v()}),Squire.prototype.testPresenceinSelection=function(e,n,t,i){var r,a;return r=this.getPath(),a=i.test(r)|this.hasFormat(t),e===n&&a},n.action=function(e){var t,i,r,a,s;if(o)if(s={value:e,testBold:o.testPresenceinSelection("bold",e,"B",/>B\b/),testItalic:o.testPresenceinSelection("italic",e,"I",/>I\b/),testUnderline:o.testPresenceinSelection("underline",e,"U",/>U\b/),testOrderedList:o.testPresenceinSelection("makeOrderedList",e,"OL",/>OL\b/),testUnorderedList:o.testPresenceinSelection("makeUnorderedList",e,"UL",/>UL\b/),testLink:o.testPresenceinSelection("removeLink",e,"A",/>A\b/),testQuote:o.testPresenceinSelection("increaseQuoteLevel",e,"blockquote",/>blockquote\b/),isNotValue:function(n){return n===e&&""!==this.value}},s.testBold||s.testItalic||s.testUnderline||s.testOrderedList||s.testUnorderedList||s.testQuote||s.testLink){if(s.testBold&&o.removeBold(),s.testItalic&&o.removeItalic(),s.testUnderline&&o.removeUnderline(),s.testOrderedList&&o.removeList(),s.testUnorderedList&&o.removeList(),s.testQuote&&o.decreaseQuoteLevel(),s.testLink)return o.removeLink(),o.focus()}else if(!s.isNotValue("removeLink")){if("makeLink"===e){if(!n.canAddLink())return;return i=angular.element(o.getSelection().commonAncestorContainer).closest("a")[0],i&&(r=u[0].contentWindow.document.createRange(),r.selectNodeContents(i),a=u[0].contentWindow.getSelection(),a.removeAllRanges(),a.addRange(r)),t=n.data.link.match(/^\s*?javascript:/i)?l:n.data.link,o.makeLink(t,{target:"_blank",title:t,rel:"nofollow"}),n.data.link=l,o.focus()}return o[e](),o.focus()}}}}}]).directive("squireCover",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isCoverVisible()"\n    ng-click=\'hideCover()\'\n    class="angular-squire-cover">\n</ng-transclude>',link:function(e,n,t,i){var r;return r=!0,e.isCoverVisible=function(){return r},e.hideCover=function(){return r=!1,i.editorVisibility(!0)},i.editorVisibility(!r),e.$watch(function(){return i.editorVisibility()},function(e){return r=!e})}}}).directive("squireControls",function(){return{restrict:"E",scope:!1,replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isControlsVisible()"\n    class="angular-squire-controls">\n</ng-transclude>',link:function(e,n,t,i){return e.isControlsVisible=function(){return i.editorVisibility()}}}}).provider("squireService",[function(){var e,n,t,i;return e=new Sanitize({elements:["div","span","b","i","ul","ol","li","blockquote","a","p","br","u"],attributes:{__ALL__:["class"],a:["href","title","target","rel"]},protocols:{a:{href:["ftp","http","https","mailto","gopher"]}}}),i={paste:e,input:e},n=!0,t={onPaste:function(){},onChange:function(e){return e},sanitize:{paste:function(e,r){return n&&(e.fragment=i.paste.clean_node(e.fragment)),t.onPaste(e,r)},input:function(e,r){var a,s,l,o,c;if(n){for(l=document.createDocumentFragment(),c=document.createElement("body"),c.innerHTML=e;a=c.firstChild;)l.appendChild(a);for(l=i.input.clean_node(l);a=l.firstChild;)c.appendChild(a);o=c.innerHTML,e!==o&&(r.setHTML(o),e=o)}return s={html:e},t.onChange(s,r),s.html}}},this.onPaste=function(e){return e?t.onPaste=e:void 0},this.onChange=function(e){return e?t.onChange=e:void 0},this.sanitizeOptions={paste:function(e){return e?i.paste=new Sanitize(e):void 0},input:function(e){return e?i.input=new Sanitize(e):void 0}},this.strictPaste=function(n){return i.paste=n?new Sanitize({elements:["div","span","b","i","u","br","p"]}):e},this.sanitizeHtml=function(e){return null==e&&(e=!0),n=e},this.$get=function(){return t},this}])}).call(this),function(){var e;e=function(){function e(){return["angular-squire"]}return e}(),angular.module("as-demo",new e)}.call(this),angular.module("angular-squire").run(["$templateCache",function(e){e.put("/modules/angular-squire/editor.html",'<div class=\'angular-squire\'>\n    <div ng-class="{\'editor-hide\': !isEditorVisible()}" class=\'editor-container\'>\n        <div class="menu">\n            <div class="group">\n                <div title=\'Bold\' ng-click="action(\'bold\')" class="item bold">\n                    <i class="fa fa-bold"></i>\n                </div>\n                <div title=\'Italic\' ng-click="action(\'italic\')" class="item italic">\n                    <i class="fa fa-italic"></i>\n                </div>\n                <div title=\'Underline\' ng-click="action(\'underline\')" class="item underline">\n                    <i class="fa fa-underline"></i>\n                </div>\n            </div>\n            <div class="group">\n                <div title=\'Insert Link\' class="item add-link" ng-click="popoverShow($event)">\n                    <i class="fa fa-link"></i>\n                    <div class="squire-popover">\n                        <div class="arrow"></div>\n                        <div class="content">\n                            <div class="title">Insert Link</div>\n                            <input type="text"\n                                id="edit-link"\n                                placeholder="Link URL"\n                                ng-model="data.link"\n                                ng-keydown="popoverHide($event, \'makeLink\')" />\n                            <button class="double r" ng-show="canRemoveLink()"\n                                ng-click="popoverHide($event, \'removeLink\')">\n                                <span class="fa fa-remove"></span> Remove Link\n                            </button>\n                            <button class="double l" ng-show="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-edit"></span> Update Link\n                            </button>\n                            <button ng-hide="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-plus"></span> Insert Link\n                            </button>\n                        </div>\n                        <div class="squire-popover-overlay" ng-click="popoverHide($event, \'makeLink\')"></div>\n                    </div>\n                </div>\n                <div title=\'Insert Numbered List\' ng-click="action(\'makeOrderedList\')" class="item olist">\n                    <i class="fa fa-list-ol"></i>\n                </div>\n                <div title=\'Insert List\' ng-click="action(\'makeUnorderedList\')" class="item ulist">\n                    <i class="fa fa-list-ul"></i>\n                </div>\n                <div title=\'Quote\' ng-click="action(\'increaseQuoteLevel\')" class="item quote">\n                    <i class="fa fa-quote-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Header\' ng-click="action(\'makeHeading\')" class="item header">\n                    <i class="fa fa-header"></i>\n                </div>\n                <div title=\'Align Left\' ng-click="action(\'alignLeft\')" class="item aleft">\n                    <i class="fa fa-align-left"></i>\n                </div>\n                <div title=\'Align Center\' ng-click="action(\'alignCenter\')" class="item acenter">\n                    <i class="fa fa-align-center"></i>\n                </div>\n                <div title=\'Align Right\' ng-click="action(\'alignRight\')" class="item aright">\n                    <i class="fa fa-align-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Undo\' ng-click="action(\'undo\')" class="item">\n                    <i class="fa fa-undo"></i>\n                </div>\n                <div title=\'Redo\' ng-click="action(\'redo\')" class="item">\n                    <i class="fa fa-repeat"></i>\n                </div>\n            </div>\n        </div>\n\n        <div class=\'angular-squire-wrapper\' ng-style=\'{width: width, height: height}\'>\n            <div class=\'placeholder\'>\n                <div ng-show=\'showPlaceholder()\'>{{ placeholder }}</div>\n            </div>\n            <iframe frameborder=\'0\' border=\'0\' marginwidth=\'0\' marginheight=\'0\' src=\'about:blank\'></iframe>\n        </div>\n    </div>\n    <ng-transclude></ng-transclude>\n</div>\n')}]),function(){var e;e=function(){function e(e){e.onPaste(function(e){return console.log("paste event:",e)}),e.strictPaste(!0)}return e}(),angular.module("as-demo").config(["squireServiceProvider",e])}.call(this);
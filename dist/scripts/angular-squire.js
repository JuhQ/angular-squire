/**
* @preserve angular-squire - angularjs directive for squire rich text editor
* @version v0.4.2
* @link https://github.com/HourlyNerd/angular-squire
* @license MIT
**/
(function(){angular.module("angular-squire",[]).directive("squire",["squireService",function(e){return{restrict:"E",require:"ngModel",scope:{height:"@height",width:"@width",body:"=body",placeholder:"@placeholder",editorClass:"@editorClass"},replace:!0,transclude:!0,templateUrl:"/modules/angular-squire/editor.html",controller:["$scope",function(e){var n;return n=!0,e.isEditorVisible=function(){return n},e.editorVisibility=this.editorVisibility=function(t){var i;return 1!==arguments.length?n:(n=t,t&&null!=(i=e.editor)?i.focus():void 0)}}],link:function(n,t,i,r){var s,a,l,o,c,d,u,v,g,f,m,h,k,p,L;return a="http://",s="angular-squire-iframe",l=n.editor=null,n.data={link:a},p=function(i){return i=e.onChange(i),n.$evalAsync(function(){return r.$setViewValue(i),r.$isEmpty(i)?t.removeClass("squire-has-value"):t.addClass("squire-has-value")})},r.$render=function(){return null!=l?l.setHTML(r.$viewValue||""):void 0},r.$isEmpty=function(e){return angular.isString(e)?0===angular.element("<div>"+e+"</div>").text().trim().length:!e},o=function(){return l?angular.element(l.getSelection().commonAncestorContainer).closest("a").attr("href"):a},n.canRemoveLink=function(){var e;return e=o(),e&&e!==a},n.canAddLink=function(){return n.data.link&&n.data.link!==a},n.$on("$destroy",function(){return null!=l?l.destroy():void 0}),n.showPlaceholder=function(){return r.$isEmpty(r.$viewValue)},n.popoverHide=function(e,t){var i;return i=function(){return angular.element(e.target).closest(".popover-visible").removeClass("popover-visible"),n.action(t)},e.keyCode?13===e.keyCode?i():void 0:i()},n.popoverShow=function(e){var i,r;i=angular.element(e.currentTarget),angular.element(e.target).closest(".squire-popover").length||i.hasClass("popover-visible")||(i.addClass("popover-visible"),n.data.link=/>A\b/.test(l.getPath())||l.hasFormat("A")?o():a,r=t.find(".squire-popover").find("input").focus().end(),r.css({left:-1*(r.width()/2)+i.width()/2+2}))},L=function(e){var t;return t=e.head,_.each(angular.element("link"),function(n){var i;return i=e.createElement("link"),i.setAttribute("href",n.href),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),t.appendChild(i)}),e.childNodes[0].className=s+" ",n.editorClass?e.childNodes[0].className+=n.editorClass:void 0},d=t.find("iframe"),h=t.find(".menu"),c=!1,u=function(){var i;return i=d[0].contentWindow.document,L(i),r.$setPristine(),l=n.editor=new Squire(i),l.defaultBlockTag="P",n.body&&(l.setHTML(n.body),p(n.body),c=!0),l.addEventListener("willPaste",e.onPaste),l.addEventListener("input",function(){var e;return c?(e=l.getHTML(),p(e)):void 0}),l.addEventListener("focus",function(){return t.addClass("focus").triggerHandler("focus"),n.editorVisibility(!0),c=!0}),l.addEventListener("blur",function(){return t.removeClass("focus").triggerHandler("blur"),r.$pristine&&!r.$isEmpty(r.$viewValue)?r.$setTouched():r.$setPristine(),c=!0}),l.addEventListener("pathChange",function(){var e,n;return e=l.getPath(),/>A\b/.test(e)||l.hasFormat("A")?t.find(".add-link").addClass("active"):t.find(".add-link").removeClass("active"),h.attr("class","menu "+(null!=(n=e.split("BODY")[1])?n.replace(/>|\.|html|body|div/gi," ").toLowerCase():void 0))}),l.alignRight=function(){return l.setTextAlignment("right")},l.alignCenter=function(){return l.setTextAlignment("center")},l.alignLeft=function(){return l.setTextAlignment("left")},l.alignJustify=function(){return l.setTextAlignment("justify")},l.makeHeading=function(){return l.setFontSize("2em"),l.bold()}},k=navigator.userAgent,v=/Chrome/.test(k),f=/rv:11.0|IE/.test(k),g=!v&&!f,m=!1,d.on("load",function(){return m=!0}),v?u():t.one("mouseenter",function(){return g?m?u():d.on("load",u):u()}),Squire.prototype.testPresenceinSelection=function(e,n,t,i){var r,s;return r=this.getPath(),s=i.test(r)|this.hasFormat(t),e===n&&s},n.action=function(e){var t,i,r,s;if(l)if(s={value:e,testBold:l.testPresenceinSelection("bold",e,"B",/>B\b/),testItalic:l.testPresenceinSelection("italic",e,"I",/>I\b/),testUnderline:l.testPresenceinSelection("underline",e,"U",/>U\b/),testOrderedList:l.testPresenceinSelection("makeOrderedList",e,"OL",/>OL\b/),testUnorderedList:l.testPresenceinSelection("makeUnorderedList",e,"UL",/>UL\b/),testLink:l.testPresenceinSelection("removeLink",e,"A",/>A\b/),testQuote:l.testPresenceinSelection("increaseQuoteLevel",e,"blockquote",/>blockquote\b/),isNotValue:function(n){return n===e&&""!==this.value}},s.testBold||s.testItalic||s.testUnderline||s.testOrderedList||s.testUnorderedList||s.testQuote||s.testLink){if(s.testBold&&l.removeBold(),s.testItalic&&l.removeItalic(),s.testUnderline&&l.removeUnderline(),s.testOrderedList&&l.removeList(),s.testUnorderedList&&l.removeList(),s.testQuote&&l.decreaseQuoteLevel(),s.testLink)return l.removeLink(),l.focus()}else if(!s.isNotValue("removeLink")){if("makeLink"===e){if(!n.canAddLink())return;return t=angular.element(l.getSelection().commonAncestorContainer).closest("a")[0],t&&(i=d[0].contentWindow.document.createRange(),i.selectNodeContents(t),r=d[0].contentWindow.getSelection(),r.removeAllRanges(),r.addRange(i)),l.makeLink(n.data.link,{target:"_blank",title:n.data.link,rel:"nofollow"}),n.data.link=a,l.focus()}return l[e](),l.focus()}}}}}]).directive("squireCover",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isCoverVisible()"\n    ng-click=\'hideCover()\'\n    class="angular-squire-cover">\n</ng-transclude>',link:function(e,n,t,i){var r;return r=!0,e.isCoverVisible=function(){return r},e.hideCover=function(){return r=!1,i.editorVisibility(!0)},i.editorVisibility(!r),e.$watch(function(){return i.editorVisibility()},function(e){return r=!e})}}}).directive("squireControls",function(){return{restrict:"E",scope:!1,replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isControlsVisible()"\n    class="angular-squire-controls">\n</ng-transclude>',link:function(e,n,t,i){return e.isControlsVisible=function(){return i.editorVisibility()}}}}).provider("squireService",[function(){var e;return e={onPaste:function(){},onChange:function(e){return e}},this.onPaste=function(n){return n?e.onPaste=n:void 0},this.onChange=function(n){return n?e.onChange=n:void 0},this.$get=function(){return e},this}])}).call(this),angular.module("angular-squire").run(["$templateCache",function(e){e.put("/modules/angular-squire/editor.html",'<div class=\'angular-squire\'>\n    <div ng-class="{\'editor-hide\': !isEditorVisible()}" class=\'editor-container\'>\n        <div class="menu">\n            <div class="group">\n                <div title=\'Bold\' ng-click="action(\'bold\')" class="item bold">\n                    <i class="fa fa-bold"></i>\n                </div>\n                <div title=\'Italic\' ng-click="action(\'italic\')" class="item italic">\n                    <i class="fa fa-italic"></i>\n                </div>\n                <div title=\'Underline\' ng-click="action(\'underline\')" class="item underline">\n                    <i class="fa fa-underline"></i>\n                </div>\n            </div>\n            <div class="group">\n                <div title=\'Insert Link\' class="item add-link" ng-click="popoverShow($event)">\n                    <i class="fa fa-link"></i>\n                    <div class="squire-popover">\n                        <div class="arrow"></div>\n                        <div class="content">\n                            <div class="title">Insert Link</div>\n                            <input type="text"\n                                id="edit-link"\n                                placeholder="Link URL"\n                                ng-model="data.link"\n                                ng-keydown="popoverHide($event, \'makeLink\')" />\n                            <button class="double r" ng-show="canRemoveLink()"\n                                ng-click="popoverHide($event, \'removeLink\')">\n                                <span class="fa fa-remove"></span> Remove Link\n                            </button>\n                            <button class="double l" ng-show="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-edit"></span> Update Link\n                            </button>\n                            <button ng-hide="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-plus"></span> Insert Link\n                            </button>\n                        </div>\n                        <div class="squire-popover-overlay" ng-click="popoverHide($event, \'makeLink\')"></div>\n                    </div>\n                </div>\n                <div title=\'Insert Numbered List\' ng-click="action(\'makeOrderedList\')" class="item olist">\n                    <i class="fa fa-list-ol"></i>\n                </div>\n                <div title=\'Insert List\' ng-click="action(\'makeUnorderedList\')" class="item ulist">\n                    <i class="fa fa-list-ul"></i>\n                </div>\n                <div title=\'Quote\' ng-click="action(\'increaseQuoteLevel\')" class="item quote">\n                    <i class="fa fa-quote-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Header\' ng-click="action(\'makeHeading\')" class="item header">\n                    <i class="fa fa-header"></i>\n                </div>\n                <div title=\'Align Left\' ng-click="action(\'alignLeft\')" class="item aleft">\n                    <i class="fa fa-align-left"></i>\n                </div>\n                <div title=\'Align Center\' ng-click="action(\'alignCenter\')" class="item acenter">\n                    <i class="fa fa-align-center"></i>\n                </div>\n                <div title=\'Align Right\' ng-click="action(\'alignRight\')" class="item aright">\n                    <i class="fa fa-align-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Undo\' ng-click="action(\'undo\')" class="item">\n                    <i class="fa fa-undo"></i>\n                </div>\n                <div title=\'Redo\' ng-click="action(\'redo\')" class="item">\n                    <i class="fa fa-repeat"></i>\n                </div>\n            </div>\n        </div>\n\n        <div class=\'angular-squire-wrapper\' ng-style=\'{width: width, height: height}\'>\n            <div class=\'placeholder\'>\n                <div ng-show=\'showPlaceholder()\'>{{ placeholder }}</div>\n            </div>\n            <iframe frameborder=\'0\' border=\'0\' marginwidth=\'0\' marginheight=\'0\' src=\'about:blank\'></iframe>\n        </div>\n    </div>\n    <ng-transclude></ng-transclude>\n</div>\n')}]);
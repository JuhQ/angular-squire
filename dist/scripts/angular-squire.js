(function(){angular.module("angular-squire",["mgcrea.ngStrap","mgcrea.ngStrap.helpers.parseOptions"]).directive("squire",["$timeout","$templateCache","$popover",function(e,n,t){return{restrict:"E",require:"ngModel",scope:{height:"@height",width:"@width",body:"=body",placeholder:"@placeholder",editorClass:"@editorClass"},replace:!0,transclude:!0,template:'<div class=\'angular-squire\'>\n    <div ng-class="{\'editor-hide\': !isEditorVisible()}" class=\'editor-container\'>\n        <div class="menu">\n            <div class="group">\n                <div title=\'Bold\' ng-click="action(\'bold\')" class="item bold">\n                    <i class="fa fa-bold"></i>\n                </div>\n                <div title=\'Italic\' ng-click="action(\'italic\')" class="item italic">\n                    <i class="fa fa-italic"></i>\n                </div>\n                <div title=\'Underline\' ng-click="action(\'underline\')"\n                    class="item underline">\n                    <i class="fa fa-underline"></i>\n                </div>\n            </div>\n            <div class="group">\n                <div title=\'Insert Link\' class="item add-link">\n                    <i class="fa fa-link"></i>\n                </div>\n                <div title=\'Insert Numbered List\'\n                    ng-click="action(\'makeOrderedList\')" class="item olist">\n                    <i class="fa fa-list-ol"></i>\n                </div>\n                <div title=\'Insert List\'\n                    ng-click="action(\'makeUnorderedList\')" class="item ulist">\n                    <i class="fa fa-list-ul"></i>\n                </div>\n                <div title=\'Quote\'\n                    ng-click="action(\'increaseQuoteLevel\')" class="item quote">\n                    <i class="fa fa-quote-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Header\' ng-click="action(\'makeHeading\')"\n                    class="item header">\n                    <i class="fa fa-header"></i>\n                </div>\n                <div title=\'Align Left\' ng-click="action(\'alignLeft\')"\n                    class="item aleft">\n                    <i class="fa fa-align-left"></i>\n                </div>\n                <div title=\'Align Center\' ng-click="action(\'alignCenter\')"\n                    class="item acenter">\n                    <i class="fa fa-align-center"></i>\n                </div>\n                <div title=\'Align Right\' ng-click="action(\'alignRight\')"\n                    class="item aright">\n                    <i class="fa fa-align-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Undo\'\n                    ng-click="action(\'undo\')"\n                    class="item">\n                    <i class="fa fa-undo"></i>\n                </div>\n                <div title=\'Redo\'\n                    ng-click="action(\'redo\')"\n                    class="item">\n                    <i class="fa fa-repeat"></i>\n                </div>\n            </div>\n        </div>\n        <div class=\'wrapper\' ng-style=\'{width: width, height: height}\'>\n            <div class=\'placeholder\'>\n                <div ng-show=\'showPlaceholder()\'>{{ placeholder }}</div>\n            </div>\n            <iframe frameborder=\'0\' border=\'0\' marginwidth=\'0\'\n                marginheight=\'0\' src=\'about:blank\'>\n            </iframe>\n        </div>\n    </div>\n    <ng-transclude></ng-transclude>\n</div>',controller:["$scope",function(e){var n;return n=!0,e.isEditorVisible=function(){return n},e.editorVisibility=this.editorVisibility=function(t){var i;return 1!==arguments.length?n:(n=t,t&&null!=(i=e.editor)?i.focus():void 0)}}],link:function(e,i,r,a){var l,s,o,c,d,u,v,g,f,m;return o=e.editor=null,g=[],l="http://",c=function(){return angular.element(o.getSelection().commonAncestorContainer).closest("a").attr("href")},e.canRemoveLink=function(){var e;return e=c(),e&&e!==l},e.canAddLink=function(){return e.data.link&&e.data.link!==l},e.data={link:l},n.get("angular-squire/popover.html")||n.put("angular-squire/popover.html",'<div class=\'angular-squire-popover\'>\n    <strong>Insert Link</strong>\n    <div class="form-group has-feedback">\n        <input type="text" class="form-control"\n            id=\'edit-link\' placeholder="Link URL"\n            ng-model=\'data.link\'\n            ng-keydown=\'popoverHide($event, "makeLink")\'/>\n        <label for="edit-link" title="Remove Link"\n            ng-show="canRemoveLink()"\n            ng-click="action(\'removeLink\')"\n            class="glyphicon glyphicon-remove\n                text-danger form-control-feedback close-popover">\n        </label>\n    </div>\n    <div ng-if="!canRemoveLink()" class="btn btn-success btn-block"\n        ng-class="{disabled: !canAddLink()}"\n        ng-click="action(\'makeLink\')">\n        Insert\n    </div>\n    <div ng-if="canRemoveLink()"class="btn btn-success btn-block"\n        ng-class="{disabled: !canAddLink()}"\n        ng-click="action(\'makeLink\')">\n        Update\n    </div>\n</div>'),e.$on("$destroy",function(){return null!=o?o.destroy():void 0}),e.showPlaceholder=function(){return 0===angular.element("<div>"+a.$viewValue+"</div>").text().trim().length},e.popoverHide=function(n,t){return 13===n.keyCode?(_.each(g,function(e){return e.hide()}),e.action(t)):void 0},e.$on("tooltip.show.before",function(){return o?e.data.link=/>A\b/.test(o.getPath())||o.hasFormat("A")?c():l:void 0}),e.$on("tooltip.show",function(e,n){return o?n.$element.find("input").focus():void 0}),f=function(n){return e.$evalAsync(function(){return a.$setViewValue(n)})},m=function(){var n,t;return n=o.getDocument(),t=n.head,_.each(angular.element("link"),function(e){var i;return i=n.createElement("link"),i.setAttribute("href",e.href),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),t.appendChild(i)}),n.childNodes[0].className="angular-squire-iframe ",e.editorClass?n.childNodes[0].className+=e.editorClass:void 0},s=function(){return g.push(t(i.find(".add-link"),{contentTemplate:"angular-squire/popover.html",autoClose:!0,html:!0,scope:e,placement:"bottom"}))},d=i.find("iframe"),v=i.find(".menu"),u=function(){return o=e.editor=new Squire(d[0].contentWindow.document),o.defaultBlockTag="P",e.body&&o.setHTML(e.body),m(),s(),o.addEventListener("input",function(){return f(o.getHTML())}),o.addEventListener("focus",function(){return i.addClass("focus"),_.each(g,function(e){return e.hide()}),e.editorVisibility(!0)}),o.addEventListener("blur",function(){return i.removeClass("focus"),f(o.getHTML())}),o.addEventListener("pathChange",function(){var e;return e=o.getPath(),/>A\b/.test(e)||o.hasFormat("A")?i.find(".add-link").addClass("active"):i.find(".add-link").removeClass("active"),v.attr("class","menu "+e.replace(/>|\.|html|body|div/gi," ").toLowerCase())}),o.alignRight=function(){return o.setTextAlignment("right")},o.alignCenter=function(){return o.setTextAlignment("center")},o.alignLeft=function(){return o.setTextAlignment("left")},o.alignJustify=function(){return o.setTextAlignment("justify")},o.makeHeading=function(){return o.setFontSize("2em"),o.bold()}},/WebKit\//.test(navigator.userAgent)?u():d.on("load",u),Squire.prototype.testPresenceinSelection=function(e,n,t,i){var r,a;return r=this.getPath(),a=i.test(r)|this.hasFormat(t),e===n&&a},e.action=function(n){var t,i,r,a;if(o){if(a={value:n,testBold:o.testPresenceinSelection("bold",n,"B",/>B\b/),testItalic:o.testPresenceinSelection("italic",n,"I",/>I\b/),testUnderline:o.testPresenceinSelection("underline",n,"U",/>U\b/),testOrderedList:o.testPresenceinSelection("makeOrderedList",n,"OL",/>OL\b/),testUnorderedList:o.testPresenceinSelection("makeUnorderedList",n,"UL",/>UL\b/),testLink:o.testPresenceinSelection("removeLink",n,"A",/>A\b/),testQuote:o.testPresenceinSelection("increaseQuoteLevel",n,"blockquote",/>blockquote\b/),isNotValue:function(e){return e===n&&""!==this.value}},a.testBold&&o.removeBold(),a.testItalic&&o.removeItalic(),a.testUnderline&&o.removeUnderline(),a.testOrderedList&&o.removeList(),a.testUnorderedList&&o.removeList(),a.testQuote&&o.decreaseQuoteLevel(),a.testLink)return o.removeLink(),o.focus();if(!a.isNotValue("removeLink")){if("makeLink"===n){if(!e.canAddLink())return;return t=angular.element(o.getSelection().commonAncestorContainer).closest("a")[0],t&&(i=d[0].contentWindow.document.createRange(),i.selectNodeContents(t),r=d[0].contentWindow.getSelection(),r.removeAllRanges(),r.addRange(i)),o.makeLink(e.data.link,{target:"_blank",title:e.data.link,rel:"nofollow"}),e.data.link=l,o.focus()}return o[n](),o.focus()}}}}}}]).directive("squireCover",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isCoverVisible()"\n    ng-click=\'hideCover()\'\n    class="angular-squire-cover">\n</ng-transclude>',link:function(e,n,t,i){var r;return r=!0,e.isCoverVisible=function(){return r},e.hideCover=function(){return r=!1,i.editorVisibility(!0)},i.editorVisibility(!r),e.$watch(function(){return i.editorVisibility()},function(e){return r=!e})}}}).directive("squireControls",function(){return{restrict:"E",scope:!1,replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isControlsVisible()"\n    class="angular-squire-controls">\n</ng-transclude>',link:function(e,n,t,i){return e.isControlsVisible=function(){return i.editorVisibility()}}}})}).call(this);
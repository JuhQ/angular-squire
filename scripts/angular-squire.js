(function(){angular.module("angular-squire",[]).directive("squire",function(){return{restrict:"E",require:"ngModel",scope:{height:"@height",width:"@width",body:"=body",placeholder:"@placeholder",editorClass:"@editorClass"},replace:!0,transclude:!0,templateUrl:"/modules/angular-squire/editor.html",controller:["$scope",function(e){var n;return n=!0,e.isEditorVisible=function(){return n},e.editorVisibility=this.editorVisibility=function(t){var i;return 1!==arguments.length?n:(n=t,t&&null!=(i=e.editor)?i.focus():void 0)}}],link:function(e,n,t,i){var r,s,a,l,o,c,d,u;return s=e.editor=null,r="http://",a=function(){return angular.element(s.getSelection().commonAncestorContainer).closest("a").attr("href")},e.canRemoveLink=function(){var e;return e=a(),e&&e!==r},e.canAddLink=function(){return e.data.link&&e.data.link!==r},e.data={link:r},e.$on("$destroy",function(){return null!=s?s.destroy():void 0}),e.showPlaceholder=function(){return 0===angular.element("<div>"+i.$viewValue+"</div>").text().trim().length},e.popoverHide=function(n,t){var i;return i=function(){return angular.element(n.target).closest(".popover-visible").removeClass("popover-visible"),e.action(t)},n.keyCode?13===n.keyCode?i():void 0:i()},e.popoverShow=function(t){var i,l;i=angular.element(t.currentTarget),angular.element(t.target).closest(".squire-popover").length||i.hasClass("popover-visible")||(i.addClass("popover-visible"),e.data.link=/>A\b/.test(s.getPath())||s.hasFormat("A")?a():r,l=n.find(".squire-popover").find("input").focus().end(),l.css({left:-1*(l.width()/2)+i.width()/2+2}))},d=function(n){return e.$evalAsync(function(){return i.$setViewValue(n)})},i.$render=function(){return s.setHTML(i.$viewValue||"")},u=function(){var n,t;return n=s.getDocument(),t=n.head,_.each(angular.element("link"),function(e){var i;return i=n.createElement("link"),i.setAttribute("href",e.href),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),t.appendChild(i)}),n.childNodes[0].className="angular-squire-iframe ",e.editorClass?n.childNodes[0].className+=e.editorClass:void 0},l=n.find("iframe"),c=n.find(".menu"),o=function(){return s=e.editor=new Squire(l[0].contentWindow.document),s.defaultBlockTag="P",u(),s.addEventListener("input",function(){return d(s.getHTML())}),s.addEventListener("focus",function(){return n.addClass("focus"),e.editorVisibility(!0)}),s.addEventListener("blur",function(){return n.removeClass("focus"),d(s.getHTML())}),s.addEventListener("pathChange",function(){var e;return e=s.getPath(),/>A\b/.test(e)||s.hasFormat("A")?n.find(".add-link").addClass("active"):n.find(".add-link").removeClass("active"),c.attr("class","menu "+e.replace(/>|\.|html|body|div/gi," ").toLowerCase())}),s.alignRight=function(){return s.setTextAlignment("right")},s.alignCenter=function(){return s.setTextAlignment("center")},s.alignLeft=function(){return s.setTextAlignment("left")},s.alignJustify=function(){return s.setTextAlignment("justify")},s.makeHeading=function(){return s.setFontSize("2em"),s.bold()}},/WebKit\//.test(navigator.userAgent)?o():l.on("load",o),Squire.prototype.testPresenceinSelection=function(e,n,t,i){var r,s;return r=this.getPath(),s=i.test(r)|this.hasFormat(t),e===n&&s},e.action=function(n){var t,i,a,o;if(s)if(o={value:n,testBold:s.testPresenceinSelection("bold",n,"B",/>B\b/),testItalic:s.testPresenceinSelection("italic",n,"I",/>I\b/),testUnderline:s.testPresenceinSelection("underline",n,"U",/>U\b/),testOrderedList:s.testPresenceinSelection("makeOrderedList",n,"OL",/>OL\b/),testUnorderedList:s.testPresenceinSelection("makeUnorderedList",n,"UL",/>UL\b/),testLink:s.testPresenceinSelection("removeLink",n,"A",/>A\b/),testQuote:s.testPresenceinSelection("increaseQuoteLevel",n,"blockquote",/>blockquote\b/),isNotValue:function(e){return e===n&&""!==this.value}},o.testBold||o.testItalic||o.testUnderline||o.testOrderedList||o.testUnorderedList||o.testQuote||o.testLink){if(o.testBold&&s.removeBold(),o.testItalic&&s.removeItalic(),o.testUnderline&&s.removeUnderline(),o.testOrderedList&&s.removeList(),o.testUnorderedList&&s.removeList(),o.testQuote&&s.decreaseQuoteLevel(),o.testLink)return s.removeLink(),s.focus()}else if(!o.isNotValue("removeLink")){if("makeLink"===n){if(!e.canAddLink())return;return t=angular.element(s.getSelection().commonAncestorContainer).closest("a")[0],t&&(i=l[0].contentWindow.document.createRange(),i.selectNodeContents(t),a=l[0].contentWindow.getSelection(),a.removeAllRanges(),a.addRange(i)),s.makeLink(e.data.link,{target:"_blank",title:e.data.link,rel:"nofollow"}),e.data.link=r,s.focus()}return s[n](),s.focus()}}}}}).directive("squireCover",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isCoverVisible()"\n    ng-click=\'hideCover()\'\n    class="angular-squire-cover">\n</ng-transclude>',link:function(e,n,t,i){var r;return r=!0,e.isCoverVisible=function(){return r},e.hideCover=function(){return r=!1,i.editorVisibility(!0)},i.editorVisibility(!r),e.$watch(function(){return i.editorVisibility()},function(e){return r=!e})}}}).directive("squireControls",function(){return{restrict:"E",scope:!1,replace:!0,transclude:!0,require:"^squire",template:'<ng-transclude ng-show="isControlsVisible()"\n    class="angular-squire-controls">\n</ng-transclude>',link:function(e,n,t,i){return e.isControlsVisible=function(){return i.editorVisibility()}}}})}).call(this),angular.module("angular-squire").run(["$templateCache",function(e){e.put("/modules/angular-squire/editor.html",'<div class=\'angular-squire\'>\n    <div ng-class="{\'editor-hide\': !isEditorVisible()}" class=\'editor-container\'>\n        <div class="menu">\n            <div class="group">\n                <div title=\'Bold\' ng-click="action(\'bold\')" class="item bold">\n                    <i class="fa fa-bold"></i>\n                </div>\n                <div title=\'Italic\' ng-click="action(\'italic\')" class="item italic">\n                    <i class="fa fa-italic"></i>\n                </div>\n                <div title=\'Underline\' ng-click="action(\'underline\')" class="item underline">\n                    <i class="fa fa-underline"></i>\n                </div>\n            </div>\n            <div class="group">\n                <div title=\'Insert Link\' class="item add-link" ng-click="popoverShow($event)">\n                    <i class="fa fa-link"></i>\n                    <div class="squire-popover">\n                        <div class="arrow"></div>\n                        <div class="content">\n                            <div class="title">Insert Link</div>\n                            <input type="text"\n                                id="edit-link"\n                                placeholder="Link URL"\n                                ng-model="data.link"\n                                ng-keydown="popoverHide($event, \'makeLink\')" />\n                            <button class="double r" ng-show="canRemoveLink()"\n                                ng-click="popoverHide($event, \'removeLink\')">\n                                <span class="fa fa-remove"></span> Remove Link\n                            </button>\n                            <button class="double l" ng-show="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-edit"></span> Update Link\n                            </button>\n                            <button ng-hide="canRemoveLink()"\n                                ng-class="{disabled: !canAddLink()}"\n                                ng-click="popoverHide($event, \'makeLink\')">\n                                <span class="fa fa-plus"></span> Insert Link\n                            </button>\n                        </div>\n                        <div class="squire-popover-overlay" ng-click="popoverHide($event, \'makeLink\')"></div>\n                    </div>\n                </div>\n                <div title=\'Insert Numbered List\' ng-click="action(\'makeOrderedList\')" class="item olist">\n                    <i class="fa fa-list-ol"></i>\n                </div>\n                <div title=\'Insert List\' ng-click="action(\'makeUnorderedList\')" class="item ulist">\n                    <i class="fa fa-list-ul"></i>\n                </div>\n                <div title=\'Quote\' ng-click="action(\'increaseQuoteLevel\')" class="item quote">\n                    <i class="fa fa-quote-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Header\' ng-click="action(\'makeHeading\')" class="item header">\n                    <i class="fa fa-header"></i>\n                </div>\n                <div title=\'Align Left\' ng-click="action(\'alignLeft\')" class="item aleft">\n                    <i class="fa fa-align-left"></i>\n                </div>\n                <div title=\'Align Center\' ng-click="action(\'alignCenter\')" class="item acenter">\n                    <i class="fa fa-align-center"></i>\n                </div>\n                <div title=\'Align Right\' ng-click="action(\'alignRight\')" class="item aright">\n                    <i class="fa fa-align-right"></i>\n                </div>\n            </div>\n\n            <div class="group">\n                <div title=\'Undo\' ng-click="action(\'undo\')" class="item">\n                    <i class="fa fa-undo"></i>\n                </div>\n                <div title=\'Redo\' ng-click="action(\'redo\')" class="item">\n                    <i class="fa fa-repeat"></i>\n                </div>\n            </div>\n        </div>\n\n        <div class=\'wrapper\' ng-style=\'{width: width, height: height}\'>\n            <div class=\'placeholder\'>\n                <div ng-show=\'showPlaceholder()\'>{{ placeholder }}</div>\n            </div>\n            <iframe frameborder=\'0\' border=\'0\' marginwidth=\'0\' marginheight=\'0\' src=\'about:blank\'>\n            </iframe>\n        </div>\n    </div>\n    <ng-transclude></ng-transclude>\n</div>\n')}]);